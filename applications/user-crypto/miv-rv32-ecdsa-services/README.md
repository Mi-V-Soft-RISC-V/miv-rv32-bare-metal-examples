PolarFire User Crypto ECDSA Services example
================================================================================
This Example Project demonstrates the usage of the User Crypto hardware block for 
the signature generation and verification using ECDSA service functions. It uses
**NIST-P384** elliptic curve for signature generation and verification. 

 - CALECDSASignHash() is used to generate digital signature.
 - CALECDSAVerifyHash() is used to verify the digital signature.

User can Experiment with different standard elliptic curves supported by user-
crypto core by changing curve domain parameters.

Here's the list of supported NIST-P curves 
- *P192*,*P224*,*P256*,*P384*,*P512*

**NOTE** -: Athena core uses an Elliptic curve of the following format. 

> Y = X^3 - 3X + b  

The coefficient of X is fixed to a = -3 thus one should only choose a set of
domain parameters which is based on the above mentioned elliptic curve.

There are two different build configurations provided with this project which
configure this SoftConsole project for RISC-V IMC instruction extension. 
The following configurations are provided with the example:

  - miv-rv32-imc-debug
  - miv-rv32-imc-release

Mi-V Soft Processor
--------------------------------------------------------------------------------
This example uses Mi-V SoftProcessor MiV_RV32.The design is built for debugging
MiV_RV32 through the PolarFire FPGA programming JTAG port using a FlashPro5.
To achieve this the CoreJTAGDebug IP is used to connect to the JTAG port of the
MiV_RV32.

All the platform/design specific definitions such as peripheral base addresses,
system clock frequency etc. are included in fpga_design_config.h. The
fpga_design_config.h is located at the root folder of this project.

The Mi-V Soft Processor MiV_RV32 firmware projects needs the miv_rv32_hal and 
the hal firmware(RISC-V HAL).

The RISC-V HAL is available at GitHub [Mi-V-Soft-RISC-V](https://mi-v-ecosystem.github.io/redirects/platform).
    
How to use this example
--------------------------------------------------------------------------------
This example project is targeted at a MIV_RV32 design running on a PolarFire-Eval-Kit 
connected via a USB-UART serial cable to a host PC running a terminal emulator
such as TeraTerm or Putty configured as follows:

 - 115200 baud
 - 8 data bits
 - 1 stop bit
 - no parity
 - no flow control.

Run the example project using a debugger. The example project will display
instructions over the serial port. To execute the particular service, user has
to select the options as shown over the serial port.

This program displays the return data from User Crypto processor for digital 
signature generation and verification services.

fpga_design_config (formerly known as hw_config.h)
--------------------------------------------------------------------------------
The SoftConsole project targeted for Mi-V processors now use an improved
directory structure. The fpga_design_config.h must be stored as shown below

`
    <project-root>/boards/<board-name>/fpga_design_config/fpga_design_config.h
`

Currently, this file must be hand crafted when using the Mi-V Soft Processor.
In future, all the design and soft IP configurations will be automatically
generated from the Libero design description data.

You can use the sample file provided with MIV_RV32 HAL as an example. Rename it
from sample_fpga_design_config.h to fpga_design_config.h and then customize it
per your hardware design such as SYS_CLK_FREQ, peripheral BASE addresses,
interrupt numbers, definition of MSCC_STDIO_UART_BASE_ADDR if you want a
CoreUARTapb mapped to STDIO, etc.

### Generate digital signature

Select '1' to generate a digital signature for ECDSA public-key cryptographic
service. The signature generation function take following parameters as an input. 
1. *msg* -: message string 
2. *Gx,Gy* -: which is a generator point for NIST-P384 curve. 
3. *K* -: A random per message parameter. 
4. *modulus n* -: The order of cyclic group G 
5. *private_key* -: private key to encrypt the message.

This project uses **SHA384** algorithm to generate a unique Hash value from the 
given message string. The **CALECDSASignHash()** function performs signature
generation and after the successful generation program displays a success
message along with generated signature set {R,S} on the UART terminal. 

*NOTE* -: **b** parameter of P384 elliptic is fixed as far as this example is concerned. 

### Verify digital signature:

Select '2' to verify the digital signature set {R,S} generated by ECDSA public
key cryptographic services. The program takes a public key to verify the message
signature along with other domain parameters. The **CALECDSAVerifyHash()**
function performs ECDSA signature verification and after successful completion
it returns the result of verification process. An appropriate message will be
displayed on the UART terminal based on the returned result. 

*NOTE* -: The ECDSA signature Generation operation should be executed before
executing ECDSA signature verification operation. 

### Configurations

The CAL library needs a config_user.h containing the configuration data.
This application provides following settings as per CAL requirement   
  1. A variable which provides the base address of the User Crypto hardware block
     is defined in main.c
     
     `uint32_t g_user_crypto_base_addr = 0x62000000UL;`
     
  2. A symbol INC_STDINT_H is defined in project preprocessor setting. 
     For more detail, please refer to caltypes.h file present in CAL folder.

### Test script

A test script is provided with this example which automatically enters the NIST
vectors and associated data to verify the functionality. You can use 
ecdsa_services.ttl Tera Term Macro script present in project directory for 
testing ECDSA Signature Services example project.

**NOTE:**
1. Tera Term Macros donâ€™t work with Windows 10 build 14393.0. You should update
   to Windows 10 build 14393.0.105 or [later.](https://osdn.net/ticket/browse.php?group_id=1412&tid=36526) 
2. Before running Tera Term Macro script, set language as English 
   (Setup->General->Language). Also setup transmit delay in (Setup->Serial port)
   to 5msec/char and 5msec/line.
3. By default, Tera Term log will be stored in Tera Term installation Directory.

## Target hardware

This project was tested on PolarFire-Eval-Kit with CFG4 configuration of the
MIV_RV32 design available [here](https://github.com/Mi-V-Soft-RISC-V/PolarFire-Eval-Kit/tree/main/Libero_Projects)

All the design specific definitions such as peripheral base addresses, system
clock frequency etc. are included in fpga_design_config.h. 

The firmware projects needs the HAL and the MIV_RV32 HAL firmware components.

This example project can be used with another design using a different hardware
configurations. This can be achieved by overwriting the content of this example
project's "fpga_design_config.h" file with the correct data per your Libero design.

### Booting the system

Currently the example project is configured to use FlashPro debugger to execute 
from LSRAM in both Debug and Release mode.

In the release mode build configuration, following setting is used
`--change-section-lma *-0x80000000` under
Tool Settings > Cross RISCV GNU Create Flash Image > General > Other flags. 

This will allow you to attach the release mode executable as the memory 
initialization client in Libero when you want to execute it from non-volatile memory. 

## Silicon revision dependencies

This example is tested on PolarFire MPF300TS device.

### CAL library src
 
To obtain the CAL source code and a SoftConsole project to generate the CAL
library archive file (*.a) refer [SoftConsole Documentation](https://mi-v-ecosystem.github.io/SoftConsole-Documentation/SoftConsole-v2021.3/using_softconsole/other.html#crypto-application-library).
The CAL source code is bound by license agreement and it will be available as
part of the SoftConsole installation if the CAL specific license was agreed
while installing it.